<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>9. Just-in-Time Kernel Creation &mdash; NVIDIA CUDA Quantum  documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/cudaq_override.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/_static/cudaq_override.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/sphinx_highlight.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="10. Quantum Programming Patterns" href="patterns.html" />
    <link rel="prev" title="8. Control Flow" href="control_flow.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" > 

          
          
          <a href="../../index.html" class="icon icon-home">
            NVIDIA CUDA Quantum
          </a>
              <div class="version">
                pr-516
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

  <style>
    /* Sidebar header (and topbar for mobile) */
    .wy-side-nav-search, .wy-nav-top {
      background: #76b900;
    }

    .wy-side-nav-search a:link, .wy-nav-top a:link {
      color: #fff;
    }
    .wy-side-nav-search a:visited, .wy-nav-top a:visited {
      color: #fff;
    }
    .wy-side-nav-search a:hover, .wy-nav-top a:hover {
      color: #fff;
    }

    .wy-menu-vertical a:link, .wy-menu-vertical a:visited {
      color: #d9d9d9
    }

    .wy-menu-vertical a:active {
      background-color: #76b900
    }

    .wy-side-nav-search>div.version {
      color: rgba(0, 0, 0, 0.3)
    }

    /* override table width restrictions */
    .wy-table-responsive table td, .wy-table-responsive table th {
        white-space: normal;
    }

    .wy-table-responsive {
        margin-bottom: 24px;
        max-width: 100%;
        overflow: visible;
    }
  </style>
  
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../install.html">   Getting Started</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../install.html#docker-image">Docker Image</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../install.html#install-the-docker-image">Install the Docker Image</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../install.html#use-cuda-quantum-in-a-terminal">Use CUDA Quantum in a Terminal</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../install.html#use-cuda-quantum-in-vs-code">Use CUDA Quantum in VS Code</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../install.html#python-wheels">Python wheels</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../install.html#build-cuda-quantum-from-source">Build CUDA Quantum from Source</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../install.html#next-steps">Next Steps</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../using/cudaq.html">   Learn the Basics</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../using/cudaq/prereqs.html">CUDA Quantum Prerequisites</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../using/cudaq/compiling.html">Compiling CUDA Quantum Programs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../using/cudaq/kernel.html">What is a CUDA Quantum Kernel?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../using/cudaq/allocating_quantum_memory.html">Allocating Quantum Memory</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../using/cudaq/runtime_v_compile.html">Runtime Versus Compile-time Kernels</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../using/cudaq/generic_functions.html">Generic Library Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../using/cudaq/builder.html">Creating Kernels at Runtime</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../using/cudaq/variational.html">Variational Algorithms</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../using/cudaq/platform.html">Asynchronous Execution</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../using/cudaq/verbose_out.html">Debugging and Verbose Logging</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../using/advanced.html">   Advanced Topics</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../using/advanced/nvqir_simulator.html">Create a new NVQIR Simulator</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../using/advanced/nvqir_simulator.html#circuitsimulator"><code class="code docutils literal notranslate"><span class="pre">CircuitSimulator</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../using/advanced/nvqir_simulator.html#let-s-see-this-in-action">Let’s see this in action</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../using/advanced/cmake_app.html">Downstream CMake Integration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../using/advanced/cudaq_ir.html">Working with CUDA Quantum IR</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../using/advanced/mlir_pass.html">Create an MLIR Pass for CUDA Quantum</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../using/examples.html">   Examples</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../using/cpp.html">   CUDA Quantum in C++</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../using/cpp.html#introduction">Introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../using/cpp.html#computing-expectation-values">Computing Expectation Values</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../using/cpp.html#multi-control-synthesis">Multi-control Synthesis</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../using/cpp.html#simulations-with-cuquantum">Simulations with cuQuantum</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../using/cpp.html#using-quantum-hardware-providers">Using Quantum Hardware Providers</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../using/python.html">   CUDA Quantum in Python</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../using/python.html#introduction">Introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../using/python.html#bernstein-vazirani">Bernstein-Vazirani</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../using/python.html#variational-quantum-eigensolver">Variational Quantum Eigensolver</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../using/python.html#quantum-approximate-optimization-algorithm">Quantum Approximate Optimization Algorithm</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../using/python.html#using-quantum-hardware-providers">Using Quantum Hardware Providers</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../using/simulators.html">   Simulator Backends</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../using/simulators.html#state-vector-simulators">State Vector Simulators</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../using/simulators.html#cuquantum-single-gpu">cuQuantum single-GPU</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../using/simulators.html#cuquantum-multi-node-multi-gpu">cuQuantum multi-node multi-GPU</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../using/simulators.html#openmp-cpu-only">OpenMP CPU-only</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../using/simulators.html#tensor-network-simulators">Tensor Network Simulators</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../using/simulators.html#id1">cuQuantum multi-node multi-GPU</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../using/hardware.html">   Hardware Backends</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../using/hardware.html#quantinuum">Quantinuum</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../using/hardware.html#setting-credentials">Setting Credentials</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../using/hardware.html#submission-from-c">Submission from C++</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../using/hardware.html#submission-from-python">Submission from Python</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../using/hardware.html#ionq">IonQ</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../using/hardware.html#id1">Setting Credentials</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../using/hardware.html#id2">Submission from C++</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../using/hardware.html#id3">Submission from Python</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">   Specifications</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="../cudaq.html">   Language Specification</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="machine_model.html">1. Machine Model</a></li>
<li class="toctree-l3"><a class="reference internal" href="namespace.html">2. Namespace</a></li>
<li class="toctree-l3"><a class="reference internal" href="types.html">3. Quantum Types</a><ul>
<li class="toctree-l4"><a class="reference internal" href="types.html#cudaq-qudit-levels">3.1. <code class="code docutils literal notranslate"><span class="pre">cudaq::qudit&lt;Levels&gt;</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="types.html#cudaq-qubit">3.2. <code class="code docutils literal notranslate"><span class="pre">cudaq::qubit</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="types.html#quantum-containers">3.3. Quantum Containers</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="operators.html">4. Quantum Operators</a><ul>
<li class="toctree-l4"><a class="reference internal" href="operators.html#cudaq-spin-op">4.1. <code class="code docutils literal notranslate"><span class="pre">cudaq::spin_op</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="operations.html">5. Quantum Operations</a><ul>
<li class="toctree-l4"><a class="reference internal" href="operations.html#operations-on-cudaq-qubit">5.1. Operations on <code class="code docutils literal notranslate"><span class="pre">cudaq::qubit</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="kernels.html">6. Quantum Kernels</a><ul>
<li class="toctree-l4"><a class="reference internal" href="kernels.html#kernel-composability">6.1. Kernel Composability</a></li>
<li class="toctree-l4"><a class="reference internal" href="kernels.html#allowed-kernel-classical-function-invocations">6.2. Allowed Kernel Classical Function Invocations</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="synthesis.html">7. Sub-circuit Synthesis</a></li>
<li class="toctree-l3"><a class="reference internal" href="control_flow.html">8. Control Flow</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">9. Just-in-Time Kernel Creation</a></li>
<li class="toctree-l3"><a class="reference internal" href="patterns.html">10. Quantum Patterns</a><ul>
<li class="toctree-l4"><a class="reference internal" href="patterns.html#compute-action-uncompute">10.1. Compute-Action-Uncompute</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="platform.html">11. Platform</a></li>
<li class="toctree-l3"><a class="reference internal" href="algorithmic_primitives.html">12. Algorithmic Primitives</a><ul>
<li class="toctree-l4"><a class="reference internal" href="algorithmic_primitives.html#cudaq-sample">12.1. <code class="code docutils literal notranslate"><span class="pre">cudaq::sample</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="algorithmic_primitives.html#cudaq-observe">12.2. <code class="code docutils literal notranslate"><span class="pre">cudaq::observe</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="algorithmic_primitives.html#cudaq-optimizer">12.3. <code class="code docutils literal notranslate"><span class="pre">cudaq::optimizer</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="algorithmic_primitives.html#cudaq-gradient">12.4. <code class="code docutils literal notranslate"><span class="pre">cudaq::gradient</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="examples.html">13. Example Programs</a><ul>
<li class="toctree-l4"><a class="reference internal" href="examples.html#hello-world-simple-bell-state">13.1. Hello World - Simple Bell State</a></li>
<li class="toctree-l4"><a class="reference internal" href="examples.html#ghz-state-preparation-and-sampling">13.2. GHZ State Preparation and Sampling</a></li>
<li class="toctree-l4"><a class="reference internal" href="examples.html#quantum-phase-estimation">13.3. Quantum Phase Estimation</a></li>
<li class="toctree-l4"><a class="reference internal" href="examples.html#deuteron-binding-energy-parameter-sweep">13.4. Deuteron Binding Energy Parameter Sweep</a></li>
<li class="toctree-l4"><a class="reference internal" href="examples.html#grover-s-algorithm">13.5. Grover’s Algorithm</a></li>
<li class="toctree-l4"><a class="reference internal" href="examples.html#iterative-phase-estimation">13.6. Iterative Phase Estimation</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../quake-dialect.html">   Quake Specification</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../quake-dialect.html#general-introduction">General Introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="../quake-dialect.html#motivation">Motivation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../quake-dialect.html#quake-types">Quake Types</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../api/api.html">   API Reference</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../api/languages/cpp_api.html">C++ API</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/languages/cpp_api.html#operators">Operators</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/languages/cpp_api.html#quantum">Quantum</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/languages/cpp_api.html#common">Common</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/languages/cpp_api.html#noise-modeling">Noise Modeling</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/languages/cpp_api.html#kernel-builder">Kernel Builder</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/languages/cpp_api.html#algorithms">Algorithms</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/languages/cpp_api.html#platform">Platform</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/languages/cpp_api.html#namespaces">Namespaces</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../api/languages/python_api.html">Python API</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/languages/python_api.html#cudaq.initialize_cudaq"><code class="docutils literal notranslate"><span class="pre">initialize_cudaq()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/languages/python_api.html#cudaq.num_available_gpus"><code class="docutils literal notranslate"><span class="pre">num_available_gpus()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/languages/python_api.html#cudaq.set_random_seed"><code class="docutils literal notranslate"><span class="pre">set_random_seed()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/languages/python_api.html#program-construction">Program Construction</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api/languages/python_api.html#cudaq.make_kernel"><code class="docutils literal notranslate"><span class="pre">make_kernel()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/languages/python_api.html#cudaq.Kernel"><code class="docutils literal notranslate"><span class="pre">Kernel</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../api/languages/python_api.html#kernel-execution">Kernel Execution</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api/languages/python_api.html#cudaq.sample"><code class="docutils literal notranslate"><span class="pre">sample()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/languages/python_api.html#cudaq.sample_async"><code class="docutils literal notranslate"><span class="pre">sample_async()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/languages/python_api.html#cudaq.observe"><code class="docutils literal notranslate"><span class="pre">observe()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/languages/python_api.html#cudaq.observe_async"><code class="docutils literal notranslate"><span class="pre">observe_async()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/languages/python_api.html#cudaq.vqe"><code class="docutils literal notranslate"><span class="pre">vqe()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../api/languages/python_api.html#backend-configuration">Backend Configuration</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api/languages/python_api.html#cudaq.has_target"><code class="docutils literal notranslate"><span class="pre">has_target()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/languages/python_api.html#cudaq.get_target"><code class="docutils literal notranslate"><span class="pre">get_target()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/languages/python_api.html#cudaq.get_targets"><code class="docutils literal notranslate"><span class="pre">get_targets()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/languages/python_api.html#cudaq.set_target"><code class="docutils literal notranslate"><span class="pre">set_target()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/languages/python_api.html#cudaq.reset_target"><code class="docutils literal notranslate"><span class="pre">reset_target()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/languages/python_api.html#cudaq.set_noise"><code class="docutils literal notranslate"><span class="pre">set_noise()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/languages/python_api.html#cudaq.unset_noise"><code class="docutils literal notranslate"><span class="pre">unset_noise()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../api/languages/python_api.html#data-types">Data Types</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api/languages/python_api.html#cudaq.QuakeValue"><code class="docutils literal notranslate"><span class="pre">QuakeValue</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/languages/python_api.html#cudaq.qubit"><code class="docutils literal notranslate"><span class="pre">qubit</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/languages/python_api.html#cudaq.qreg"><code class="docutils literal notranslate"><span class="pre">qreg</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/languages/python_api.html#cudaq.ComplexMatrix"><code class="docutils literal notranslate"><span class="pre">ComplexMatrix</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/languages/python_api.html#cudaq.SpinOperator"><code class="docutils literal notranslate"><span class="pre">SpinOperator</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/languages/python_api.html#cudaq.spin.i"><code class="docutils literal notranslate"><span class="pre">spin.i()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/languages/python_api.html#cudaq.spin.x"><code class="docutils literal notranslate"><span class="pre">spin.x()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/languages/python_api.html#cudaq.spin.y"><code class="docutils literal notranslate"><span class="pre">spin.y()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/languages/python_api.html#cudaq.spin.z"><code class="docutils literal notranslate"><span class="pre">spin.z()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/languages/python_api.html#cudaq.SampleResult"><code class="docutils literal notranslate"><span class="pre">SampleResult</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/languages/python_api.html#cudaq.AsyncSampleResult"><code class="docutils literal notranslate"><span class="pre">AsyncSampleResult</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/languages/python_api.html#cudaq.ObserveResult"><code class="docutils literal notranslate"><span class="pre">ObserveResult</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/languages/python_api.html#cudaq.AsyncObserveResult"><code class="docutils literal notranslate"><span class="pre">AsyncObserveResult</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/languages/python_api.html#cudaq.OptimizationResult"><code class="docutils literal notranslate"><span class="pre">OptimizationResult</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/languages/python_api.html#optimizers">Optimizers</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/languages/python_api.html#gradients">Gradients</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/languages/python_api.html#noisy-simulation">Noisy Simulation</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../versions.html">   Other Versions</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">NVIDIA CUDA Quantum</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">Specifications</a></li>
          <li class="breadcrumb-item"><a href="../cudaq.html">Language Specification</a></li>
      <li class="breadcrumb-item active"><span class="section-number">9. </span>Just-in-Time Kernel Creation</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/specification/cudaq/dynamic_kernels.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="just-in-time-kernel-creation">
<h1><span class="section-number">9. </span>Just-in-Time Kernel Creation<a class="headerlink" href="#just-in-time-kernel-creation" title="Permalink to this heading">¶</a></h1>
<p>CUDA Quantum provides a set of programming abstractions for dynamically constructing
quantum kernel code at runtime. The callable <code class="code docutils literal notranslate"><span class="pre">cudaq::kernel_builder</span></code> abstraction
facilitates the dynamic definition of quantum kernels that can optionally
be parameterized by user-defined input arguments. The builder enables an
API for constructing parameterized quantum kernels but is also itself
callable. The <code class="code docutils literal notranslate"><span class="pre">kernel_builder</span></code> takes the following structure</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">namespace</span><span class="w"> </span><span class="nn">cudaq</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="c1">// Type wrapping a value in the kernel IR</span>
<span class="w">  </span><span class="k">struct</span><span class="w"> </span><span class="nc">Value</span><span class="p">;</span>
<span class="w">  </span><span class="k">template</span><span class="w"> </span><span class="o">&lt;</span><span class="k">typename</span><span class="p">...</span><span class="w"> </span><span class="n">Args</span><span class="o">&gt;</span>
<span class="w">  </span><span class="k">class</span><span class="w"> </span><span class="nc">kernel_builder</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">private</span><span class="o">:</span>
<span class="w">      </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">Value</span><span class="o">&gt;</span><span class="w"> </span><span class="n">arguments</span><span class="p">;</span>

<span class="w">    </span><span class="k">public</span><span class="o">:</span>
<span class="w">      </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">Value</span><span class="o">&gt;&amp;</span><span class="w"> </span><span class="n">getArguments</span><span class="p">();</span>
<span class="w">      </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="nf">name</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="p">;</span>
<span class="w">      </span><span class="n">std</span><span class="o">::</span><span class="kt">size_t</span><span class="w"> </span><span class="nf">getNumParams</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="p">;</span>

<span class="w">      </span><span class="n">Value</span><span class="w"> </span><span class="nf">qalloc</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="kt">size_t</span><span class="w"> </span><span class="n">nQubits</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<span class="w">      </span><span class="n">Value</span><span class="w"> </span><span class="nf">qalloc</span><span class="p">(</span><span class="n">Value</span><span class="w"> </span><span class="n">size</span><span class="p">);</span>

<span class="w">      </span><span class="kt">void</span><span class="w"> </span><span class="nf">h</span><span class="p">(</span><span class="n">Value</span><span class="o">&amp;</span><span class="w"> </span><span class="n">qubit</span><span class="p">);</span>
<span class="w">      </span><span class="c1">//... all other quantum operations ...</span>

<span class="w">      </span><span class="c1">// if (mz(q)) thenFunctor()</span>
<span class="w">      </span><span class="kt">void</span><span class="w"> </span><span class="nf">c_if</span><span class="p">(</span><span class="n">Value</span><span class="o">&amp;</span><span class="w"> </span><span class="n">result</span><span class="p">,</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">function</span><span class="o">&lt;</span><span class="kt">void</span><span class="p">()</span><span class="o">&gt;&amp;&amp;</span><span class="w"> </span><span class="n">thenFunctor</span><span class="p">);</span>

<span class="w">      </span><span class="c1">// Invoke a predefined kernel</span>
<span class="w">      </span><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span><span class="w"> </span><span class="nc">OtherKernelBuilder</span><span class="p">,</span><span class="w"> </span><span class="k">typename</span><span class="p">...</span><span class="w"> </span><span class="n">Values</span><span class="o">&gt;</span>
<span class="w">      </span><span class="kt">void</span><span class="w"> </span><span class="n">call</span><span class="p">(</span><span class="n">OtherKernelBuilder</span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">kernelToCall</span><span class="p">,</span><span class="w"> </span><span class="n">Values</span><span class="o">&amp;</span><span class="p">...</span><span class="w"> </span><span class="n">args</span><span class="p">);</span>

<span class="w">      </span><span class="c1">// General multi-control on a predefined kernel</span>
<span class="w">      </span><span class="c1">// models cudaq::control(...)</span>
<span class="w">      </span><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span><span class="w"> </span><span class="nc">OtherKernelBuilder</span><span class="p">,</span><span class="w"> </span><span class="k">typename</span><span class="p">...</span><span class="w"> </span><span class="n">Values</span><span class="o">&gt;</span>
<span class="w">      </span><span class="kt">void</span><span class="w"> </span><span class="n">control</span><span class="p">(</span><span class="n">OtherKernelBuilder</span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">kernelToControl</span><span class="p">,</span><span class="w"> </span><span class="n">Value</span><span class="o">&amp;</span><span class="w"> </span><span class="n">ctrl</span><span class="p">,</span><span class="w"> </span><span class="n">Values</span><span class="o">&amp;</span><span class="p">...</span><span class="w"> </span><span class="n">values</span><span class="p">);</span>

<span class="w">      </span><span class="c1">// General adjoint on a predefined kernel</span>
<span class="w">      </span><span class="c1">// models cudaq::adjoint(...)</span>
<span class="w">      </span><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span><span class="w"> </span><span class="nc">OtherKernelBuilder</span><span class="p">,</span><span class="w"> </span><span class="k">typename</span><span class="p">...</span><span class="w"> </span><span class="n">Values</span><span class="o">&gt;</span>
<span class="w">      </span><span class="kt">void</span><span class="w"> </span><span class="n">adjoint</span><span class="p">(</span><span class="n">OtherKernelBuilder</span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">kernelToAdjoint</span><span class="p">,</span><span class="w"> </span><span class="n">Values</span><span class="o">&amp;</span><span class="p">...</span><span class="w"> </span><span class="n">values</span><span class="p">);</span>

<span class="w">      </span><span class="c1">// The constructed kernel is callable</span>
<span class="w">      </span><span class="kt">void</span><span class="w"> </span><span class="nf">operator</span><span class="p">()(</span><span class="n">Args</span><span class="p">...</span><span class="w"> </span><span class="n">args</span><span class="p">);</span>
<span class="w">      </span><span class="kt">void</span><span class="w"> </span><span class="nf">operator</span><span class="p">()(</span><span class="kt">void</span><span class="o">**</span><span class="w"> </span><span class="n">argsArray</span><span class="p">);</span>

<span class="w">      </span><span class="c1">// Enable structured bindings</span>
<span class="w">      </span><span class="k">template</span><span class="w"> </span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="kt">size_t</span><span class="w"> </span><span class="n">N</span><span class="o">&gt;</span>
<span class="w">      </span><span class="k">decltype</span><span class="p">(</span><span class="k">auto</span><span class="p">)</span><span class="w"> </span><span class="n">get</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="k">constexpr</span><span class="w"> </span><span class="p">(</span><span class="n">N</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
<span class="w">          </span><span class="k">return</span><span class="w"> </span><span class="o">*</span><span class="k">this</span><span class="p">;</span>
<span class="w">        </span><span class="k">else</span>
<span class="w">          </span><span class="k">return</span><span class="w"> </span><span class="n">arguments</span><span class="p">[</span><span class="n">N</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">];</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">  </span><span class="p">};</span>
<span class="p">}</span>

<span class="c1">/// Enable structured bindings on the kernel_builder type.</span>
<span class="c1">/// auto [kernel, theta, phi] = std::make_kernel&lt;double,double&gt;();</span>
<span class="k">namespace</span><span class="w"> </span><span class="nn">std</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">template</span><span class="w"> </span><span class="o">&lt;</span><span class="k">typename</span><span class="p">...</span><span class="w"> </span><span class="n">Args</span><span class="o">&gt;</span><span class="w"> </span><span class="c1">// std::size_t NArgs&gt;</span>
<span class="w">  </span><span class="k">struct</span><span class="w"> </span><span class="nc">tuple_size</span><span class="o">&lt;</span><span class="n">cudaq</span><span class="o">::</span><span class="n">kernel_builder</span><span class="o">&lt;</span><span class="n">Args</span><span class="p">...</span><span class="o">&gt;&gt;</span>
<span class="w">    </span><span class="o">:</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">integral_constant</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="kt">size_t</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">...(</span><span class="n">Args</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{};</span>

<span class="w">  </span><span class="k">template</span><span class="w"> </span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="kt">size_t</span><span class="w"> </span><span class="n">N</span><span class="p">,</span><span class="w"> </span><span class="k">typename</span><span class="p">...</span><span class="w"> </span><span class="n">Args</span><span class="o">&gt;</span>
<span class="w">  </span><span class="k">struct</span><span class="w"> </span><span class="nc">tuple_element</span><span class="o">&lt;</span><span class="n">N</span><span class="p">,</span><span class="w"> </span><span class="n">cudaq</span><span class="o">::</span><span class="n">kernel_builder</span><span class="o">&lt;</span><span class="n">Args</span><span class="p">...</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">using</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">conditional_t</span><span class="o">&lt;</span><span class="n">N</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">cudaq</span><span class="o">::</span><span class="n">kernel_builder</span><span class="o">&lt;</span><span class="n">Args</span><span class="p">...</span><span class="o">&gt;</span><span class="p">,</span>
<span class="w">                              </span><span class="n">cudaq</span><span class="o">::</span><span class="n">QuakeValue</span><span class="o">&gt;</span><span class="p">;</span>
<span class="w">  </span><span class="p">};</span>
<span class="p">}</span><span class="w"> </span><span class="c1">// namespace std</span>

<span class="k">namespace</span><span class="w"> </span><span class="nn">cudaq</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">kernel_builder</span><span class="o">&lt;&gt;</span><span class="w"> </span><span class="n">make_kernel</span><span class="p">();</span>
<span class="w">  </span><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span><span class="p">...</span><span class="w"> </span><span class="n">Args</span><span class="o">&gt;</span>
<span class="w">  </span><span class="n">kernel_builder</span><span class="o">&lt;</span><span class="n">Args</span><span class="p">...</span><span class="o">&gt;</span><span class="w"> </span><span class="n">make_kernel</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The structure above allows one to leverage the provided factory functions (<code class="code docutils literal notranslate"><span class="pre">make_kernel</span></code>)
to construct an empty CUDA Quantum kernel with defined argument signature.</p>
<p>For each type in the signature, the programmer is returned a new <code class="code docutils literal notranslate"><span class="pre">Value</span></code> instance which
can be leveraged in the construction of the kernel. The intended mechanism for
kernel creation and argument value extraction is via standard C++
<a class="reference external" href="https://en.cppreference.com/w/cpp/language/structured_binding">structured bindings</a>.</p>
<p>Once the kernel is created, the programmer is free to build up the kernel expression
using the exposed API. There are methods for qubit allocation, quantum operation
invocation, control and adjoint synthesis, and conditional branching based on
<code class="code docutils literal notranslate"><span class="pre">boolean</span></code> values.</p>
<p>Here is a simple example how one might build a CUDA Quantum kernel dynamically.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">auto</span><span class="w"> </span><span class="n">kernel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cudaq</span><span class="o">::</span><span class="n">make_kernel</span><span class="p">();</span>
<span class="k">auto</span><span class="w"> </span><span class="n">qubits</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">kernel</span><span class="p">.</span><span class="n">qalloc</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
<span class="n">kernel</span><span class="p">.</span><span class="n">h</span><span class="p">(</span><span class="n">qubits</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
<span class="n">kernel</span><span class="p">.</span><span class="n">x</span><span class="o">&lt;</span><span class="n">cudaq</span><span class="o">::</span><span class="n">ctrl</span><span class="o">&gt;</span><span class="p">(</span><span class="n">qubits</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="w"> </span><span class="n">qubits</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
<span class="n">kernel</span><span class="p">.</span><span class="n">mz</span><span class="p">(</span><span class="n">qubits</span><span class="p">);</span>

<span class="c1">// See algorithmic primitives section for more on sample</span>
<span class="k">auto</span><span class="w"> </span><span class="n">counts</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cudaq</span><span class="o">::</span><span class="n">sample</span><span class="p">(</span><span class="n">kernel</span><span class="p">);</span>
</pre></div>
</div>
<p>Here is an example demonstrating how one may build a dynamic set of
CUDA Quantum kernels for executing the standard Hadamard test.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">auto</span><span class="w"> </span><span class="p">[</span><span class="n">xPrep</span><span class="p">,</span><span class="w"> </span><span class="n">qubitIn</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cudaq</span><span class="o">::</span><span class="n">make_kernel</span><span class="o">&lt;</span><span class="n">cudaq</span><span class="o">::</span><span class="n">qubit</span><span class="o">&gt;</span><span class="p">();</span>
<span class="n">xPrep</span><span class="p">.</span><span class="n">x</span><span class="p">(</span><span class="n">qubitIn</span><span class="p">);</span>

<span class="c1">// Compute &lt;1|X|1&gt; = 0</span>
<span class="k">auto</span><span class="w"> </span><span class="n">hadamardTest</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cudaq</span><span class="o">::</span><span class="n">make_kernel</span><span class="p">();</span>
<span class="k">auto</span><span class="w"> </span><span class="n">q</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">hadamardTest</span><span class="p">.</span><span class="n">qalloc</span><span class="p">();</span>
<span class="k">auto</span><span class="w"> </span><span class="n">ancilla</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">hadamardTest</span><span class="p">.</span><span class="n">qalloc</span><span class="p">();</span>
<span class="n">hadamardTest</span><span class="p">.</span><span class="n">call</span><span class="p">(</span><span class="n">xPrep</span><span class="p">,</span><span class="w"> </span><span class="n">q</span><span class="p">);</span>
<span class="n">hadamardTest</span><span class="p">.</span><span class="n">h</span><span class="p">(</span><span class="n">ancilla</span><span class="p">);</span>
<span class="n">hadamardTest</span><span class="p">.</span><span class="n">control</span><span class="p">(</span><span class="n">xPrep</span><span class="p">,</span><span class="w"> </span><span class="n">ancilla</span><span class="p">,</span><span class="w"> </span><span class="n">q</span><span class="p">);</span>
<span class="n">hadamardTest</span><span class="p">.</span><span class="n">h</span><span class="p">(</span><span class="n">ancilla</span><span class="p">);</span>
<span class="n">hadamardTest</span><span class="p">.</span><span class="n">mz</span><span class="p">(</span><span class="n">ancilla</span><span class="p">);</span>

<span class="c1">// See algorithmic primitives section for more on sample</span>
<span class="k">auto</span><span class="w"> </span><span class="n">counts</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cudaq</span><span class="o">::</span><span class="n">sample</span><span class="p">(</span><span class="n">hadamardTest</span><span class="p">);</span>
</pre></div>
</div>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="control_flow.html" class="btn btn-neutral float-left" title="8. Control Flow" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="patterns.html" class="btn btn-neutral float-right" title="10. Quantum Programming Patterns" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, NVIDIA Corporation &amp; Affiliates.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(false);
      });
  </script>  

  <style>
  a:link, a:visited {
    color: #76b900;
  }

  a:hover {
    color: #8c0;
  }

  .rst-content dl:not(.docutils) dt {
    background: rgba(118, 185, 0, 0.1);
    color: rgba(59,93,0,1);
    border-top: solid 3px rgba(59,93,0,1);
  }
  </style>
  

</body>
</html>