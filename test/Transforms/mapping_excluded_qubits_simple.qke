// ========================================================================== //
// Copyright (c) 2022 - 2025 NVIDIA Corporation & Affiliates.                 //
// All rights reserved.                                                       //
//                                                                            //
// This source code and the accompanying materials are made available under   //
// the terms of the Apache License 2.0 which accompanies this distribution.   //
// ========================================================================== //

// RUN: cudaq-opt --qubit-mapping=device=path\(3,\[1\]\) %s | FileCheck %s

module {
  quake.wire_set @wires[2147483647]

  func.func @simple_excluded() attributes {"cudaq-entrypoint", "cudaq-kernel", no_this} {
    %0 = quake.borrow_wire @wires[0] : !quake.wire
    %1 = quake.borrow_wire @wires[1] : !quake.wire
    %2:2 = quake.x [%0] %1 : (!quake.wire, !quake.wire) -> (!quake.wire, !quake.wire)
    quake.return_wire %2#0 : !quake.wire
    quake.return_wire %2#1 : !quake.wire
    return
  }
}

// CHECK-LABEL: func.func @simple_excluded() attributes {"cudaq-entrypoint", "cudaq-kernel", mapping_reorder_idx = [0, 1], mapping_v2p = [0, 2], no_this} {
// CHECK:         %[[Q0:.*]] = quake.borrow_wire @mapped_wireset
// CHECK:         %[[Q1:.*]] = quake.borrow_wire @mapped_wireset
// CHECK:         %[[RES:.*]]:2 = quake.x [%[[Q0]]] %[[Q1]] : (!quake.wire, !quake.wire) -> (!quake.wire, !quake.wire)
// CHECK:         quake.return_wire %[[RES]]#0 : !quake.wire
// CHECK:         quake.return_wire %[[RES]]#1 : !quake.wire
// CHECK:         return
// CHECK:       } 